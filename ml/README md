
# Projeto: AnÃ¡lise SemÃ¢ntica de Leis com Amazon SageMaker + OpenSearch

Este projeto realiza a ingestÃ£o e anÃ¡lise semÃ¢ntica de documentos legais (leis, artigos etc.), com controle de versÃ£o, detecÃ§Ã£o de revogaÃ§Ãµes e busca semÃ¢ntica via vetores em OpenSearch.

## ğŸ“¦ Componentes

1. **Amazon S3**  
   Armazena arquivos `.xlsx` contendo leis e artigos a serem analisados.

2. **Amazon SageMaker Studio**  
   ResponsÃ¡vel por executar os scripts de:
   - Processamento e extraÃ§Ã£o dos dados
   - GeraÃ§Ã£o de embeddings semÃ¢nticos
   - AtualizaÃ§Ã£o ou inserÃ§Ã£o no OpenSearch

3. **Amazon OpenSearch Service**  
   Indexa os documentos com suporte a KNN (similaridade semÃ¢ntica).

---

## ğŸ—‚ Estrutura dos Dados

Cada linha do Excel deve conter:
- `Norma`: Ex: "Lei nÂº 5.172/1966"
- `DescriÃ§Ã£o`: Ex: "art_1o_texto do artigo..."

---

## ğŸ”„ Pipeline AutomÃ¡tico

- LÃª todos os arquivos `.xlsx` do bucket S3: `s3://compliance-legislacoes/output/`
- Extrai o artigo (`art_1o`, `art_2o`, etc.)
- Remove prefixo e limpa o texto
- Gera `embedding` com modelo `all-MiniLM-L6-v2`
- Gera um hash (`SHA-256`) do conteÃºdo
- Atualiza o OpenSearch se houver alteraÃ§Ãµes ou cria novo documento
- Marca como **revogado** se artigo anterior foi removido

---

## ğŸ” Busca SemÃ¢ntica

A consulta por similaridade Ã© realizada com KNN vectors diretamente no OpenSearch:

```python
from sentence_transformers import SentenceTransformer
modelo = SentenceTransformer("all-MiniLM-L6-v2")
vetor_consulta = modelo.encode(["texto de busca"])[0]
```

---

## âš™ï¸ Requisitos

- `boto3`
- `opensearch-py`
- `sentence-transformers`
- PermissÃµes de IAM para:
  - `s3:GetObject`
  - `es:ESHttp*`

---

## ğŸ“ ExecutÃ¡veis

- `criar_indice.py` â€” Cria o Ã­ndice `compliance_docs` com suporte a `knn_vector`
- `processar_arquivos.py` â€” LÃª arquivos do S3, processa e atualiza OpenSearch
- `consulta_semantica.py` â€” Realiza busca por similaridade

---

## ğŸ“Œ ObservaÃ§Ãµes

- A dimensÃ£o do vetor Ã© 384 (modelo MiniLM)
- O ID do documento Ã© `SHA256(titulo + artigo)`
- Campos revogados recebem `ativo: false` e `revogado_em: YYYY-MM-DD`

---

Desenvolvido para garantir rastreabilidade de alteraÃ§Ãµes legislativas com inteligÃªncia semÃ¢ntica.
